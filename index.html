<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kutatók Éjszakája - Fehérjeszimulációk</title>
  <meta name="description" content="Molekuláris dinamika szimulációs filmek" />
  <style>
    :root {
      --bg: #0b0d12; --card: #121622; --text: #e8eefc;
      --muted: #a9b3c7; --accent: #7aa2ff; --ring: rgba(122,162,255,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, #172036 0, transparent 60%),
        radial-gradient(900px 700px at 110% 10%, #13203b 0, transparent 60%),
        var(--bg);
    }
    header { padding: 28px 18px 12px; text-align: center; }
    header h1 { margin: 0 0 6px; font-weight: 700; letter-spacing: .2px; }
    header p { margin: 0; color: var(--muted); }

    .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap: 16px; }

    .card {
      background: linear-gradient(to bottom right, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.06);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border-radius: 16px; overflow: hidden;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:focus-within, .card:hover { transform: translateY(-2px); border-color: var(--ring); box-shadow: 0 18px 40px rgba(30,60,120,.3); }

    .media { position: relative; aspect-ratio: 16/9; background: #0a0f18; overflow: hidden; }
    .media img, .media video { width: 100%; height: 100%; object-fit: cover; display: block; }
    .media video { background:#000; }

    .overlay {
      position: absolute; inset: 0; display: grid; place-items: center;
      background: linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,.1));
      opacity: 1; transition: opacity .2s ease;
    }
    .media.playing .overlay { opacity: 0; pointer-events: none; }

    .playbtn {
      border: 0; background: rgba(10,20,40,.75);
      border-radius: 999px; padding: 14px 18px; display: inline-flex; gap: 10px; align-items: center;
      color: var(--text); font-weight: 600; cursor: pointer;
      box-shadow: 0 8px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.08);
      transition: transform .12s ease, background .2s ease; backdrop-filter: blur(6px);
    }
    .playbtn:hover { transform: translateY(-1px); background: rgba(20,40,80,.8); }
    .playbtn svg { width: 18px; height: 18px; }

    /* --- Custom control bar (one line, auto-hide) --- */
    .controls {
      position: absolute; left: 0; right: 0; bottom: 0; z-index: 5;
      display: flex; align-items: center; gap: 8px; padding: 8px 10px;
      border-top-left-radius: 12px; border-top-right-radius: 12px;
      background: linear-gradient(to top, rgba(0,0,0,.65), rgba(0,0,0,.25));
      backdrop-filter: blur(4px);
      opacity: 0; transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events: none; /* not clickable when hidden */
    }
    .controls.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .controls .btn {
      width: 36px; height: 36px; border-radius: 10px; border: 0; cursor: pointer; color: var(--text);
      background: rgba(0,0,0,.55); display: grid; place-items: center;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .controls .btn:hover { background: rgba(0,0,0,.7); }
    .controls .btn svg { width: 18px; height: 18px; }
    .controls .seek { -webkit-appearance:none; appearance:none; height:6px; border-radius:999px; background: rgba(255,255,255,.25); outline: none;
      flex: 1 1 auto; min-width: 0;
    }
    .controls .seek::-webkit-slider-thumb { -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:#fff; box-shadow:0 0 0 2px rgba(0,0,0,.35); }
    .controls .seek::-moz-range-thumb    { width:14px; height:14px; border-radius:50%; background:#fff; border:0; box-shadow:0 0 0 2px rgba(0,0,0,.35); }
    .controls .time { font-size: 13px; color: #e8eefce6; min-width: 88px; text-align: right; flex: 0 0 auto; }

    /* Hide cursor when UI hidden (e.g., in fullscreen) */
    .media.hide-ui { cursor: none; }

    .meta { padding: 12px 14px 16px; }
    .title { margin: 0 0 6px; font-size: 16px; line-height: 1.25; }
    .desc { margin: 0; color: var(--muted); font-size: 14px; line-height: 1.45; }

    footer { text-align:center; color: var(--muted); padding: 24px 0 44px; font-size: 13px; }
    a { color: var(--accent); text-decoration: none; } a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <h1>Kutatók Éjszakája - Fehérjeszimulációk</h1>
    <p>Kattints a <strong>fehérjére</strong>, hogy megnézd hogyan mozog. Dupla kattintással a videót is kinagyíthatod.</p>
  </header>

  <main class="container">
    <div id="gallery" class="grid" aria-live="polite"></div>
  </main>

<footer>
  Eötvös Loránd Tudományegyetem<br>
  Természettudományi Kar, Biológiai Intézet<br>
  Biokémiai Tanszék
</footer>

  <script>
    const VIDEOS = [
      { title: "Alfa-amiláz", mp4: "assets/videos/alpha_amylase_softShadows.mp4", webm: "assets/videos/alpha_amylase_softShadows.webm",
        description: "Keményítőt és glikogént bontó emésztőenzim, főként a nyálmirigyek és a hasnyálmirigy termeli." },
      { title: "Apoptoszóma", mp4: "assets/videos/apopt_3JBT-assembly1.mp4", webm: "assets/videos/apopt_3JBT-assembly1.webm",
        description: "Az Apaf-1 által szervezett fehérjekomplex, amely aktiválja a kaszpáz-9-et és elindítja a programozott sejthalált (apoptózist)." },
      { title: "Ferritin", mp4: "assets/videos/ferritin.mp4", webm: "assets/videos/ferritin.webm",
        description: "24 alegységből álló üreges „nanoketrec”, amely akár ~4500 vasatomot képes biztonságosan raktározni." },
      { title: "p53", mp4: "assets/videos/p53_1tup-assembly.mp4", webm: "assets/videos/p53_1tup-assembly.webm",
        description: "Daganat-szuppresszor fehérje. A „genom őre” néven ismert transzkripciós faktor; génje az emberi daganatok több mint 50%-ában mutált." },
      { title: "SSB4", mp4: "assets/videos/fold_ecoli_ssb_4.mp4", webm: "assets/videos/fold_ecoli_ssb_4.webm",
        description: "Egyszálú DNS-kötő fehérje. Az E. coli SSB funkcionális homotetramer, amely védi az egyszálú DNS-t és központi a replikációban, javításban és rekombinációban." },
      { title: "LC8", mp4: "assets/videos/lc8.mp4", webm: "assets/videos/lc8.webm",
        description: "Kisméretű dimer „hub” fehérje, amely sok kliensfehérje dimerizációját és nagy fehérjekomplexek összeállását segíti." },
    ];

    const ICONS = {
      play: "M8 5v14l11-7z", pause: "M6 5h4v14H6zm8 0h4v14h-4z",
      volume: "M3 10v4h4l5 5V5L7 10H3zm13.54 2a4.5 4.5 0 0 0-2.04-3.77v7.54A4.5 4.5 0 0 0 16.54 12zm2.46 0a7 7 0 0 1-3.17 5.9l1.17 1.61A9 9 0 0 0 22 12a9 9 0 0 0-4.99-8.07l-1.17 1.61A7 7 0 0 1 19 12z",
      mute: "M16.5 12 21 16.5 19.5 18l-4.5-4.5L10 18l-3-3h-4v-6h4l3-3 5 4.5L19.5 6 21 7.5 16.5 12z",
      fullscreen: "M7 14H5v5h5v-2H7v-3zm12 5h-5v-2h3v-3h2v5zM7 5h3V3H5v5h2V5zm10 0v3h3v2h-5V3h2v2z",
    };
    const $ = s => document.querySelector(s);
    function icon(pathD){ const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");
      svg.setAttribute("viewBox","0 0 24 24"); svg.setAttribute("aria-hidden","true");
      const p=document.createElementNS(svg.namespaceURI,"path"); p.setAttribute("d",pathD); p.setAttribute("fill","currentColor");
      svg.appendChild(p); return svg; }

    // Auto-poster from first frame (same-origin)
    function autoPoster(video){
      if (video.dataset.posterReady) return;
      const capture=()=>{ const w=video.videoWidth||1280, h=video.videoHeight||Math.round(w*9/16); if(!w||!h) return;
        const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d'); ctx.drawImage(video,0,0,w,h);
        video.setAttribute('poster', c.toDataURL('image/jpeg', .82)); video.dataset.posterReady='1'; };
      const seek=()=>{ const onSeeked=()=>{ video.removeEventListener('seeked', onSeeked); capture(); }; video.addEventListener('seeked', onSeeked, {once:true});
        try{ video.currentTime=0; } catch{ capture(); } };
      if (video.readyState>=2) seek(); else video.addEventListener('loadeddata', ()=>seek(), {once:true});
    }

    function renderCard(item){
      const card=document.createElement('article'); card.className='card'; card.tabIndex=0;
      const media=document.createElement('div'); media.className='media';

      const video=document.createElement('video');
      video.setAttribute('playsinline',''); video.setAttribute('muted',''); video.setAttribute('loop',''); video.setAttribute('preload','metadata');
      video.crossOrigin='anonymous'; video.setAttribute('aria-label', item.title); video.controls=false;

      const s1=document.createElement('source'); s1.src=item.mp4; s1.type='video/mp4'; video.appendChild(s1);
      if (item.webm){ const s2=document.createElement('source'); s2.src=item.webm; s2.type='video/webm'; video.appendChild(s2); }
      if (item.poster) video.setAttribute('poster', item.poster); else autoPoster(video);

      const overlay=document.createElement('div'); overlay.className='overlay';
      const playBtn=document.createElement('button'); playBtn.className='playbtn';
      playBtn.appendChild(icon(ICONS.play)); playBtn.appendChild(document.createTextNode(' Lejátszás'));
      playBtn.setAttribute('aria-label',`Play ${item.title}`); overlay.appendChild(playBtn);

      const controls=document.createElement('div'); controls.className='controls';
      const ppBtn=document.createElement('button'); ppBtn.className='btn'; ppBtn.title='Play/Pause'; ppBtn.appendChild(icon(ICONS.play));
      const seek=document.createElement('input'); seek.type='range'; seek.className='seek'; seek.min=0; seek.step=0.05; seek.value=0;
      const time=document.createElement('div'); time.className='time'; time.textContent='0:00 / 0:00';
      const volBtn=document.createElement('button'); volBtn.className='btn'; volBtn.title='Toggle sound'; volBtn.appendChild(icon(ICONS.mute));
      const fsBtn=document.createElement('button'); fsBtn.className='btn'; fsBtn.title='Fullscreen'; fsBtn.appendChild(icon(ICONS.fullscreen));
      controls.append(ppBtn, seek, time, volBtn, fsBtn);

      media.append(video, overlay, controls);

      const meta=document.createElement('div'); meta.className='meta';
      const h3=document.createElement('h3'); h3.className='title'; h3.textContent=item.title;
      const p=document.createElement('p'); p.className='desc'; p.textContent=item.description||'';
      meta.append(h3,p); card.append(media,meta);

      // --- Interactions ---
      function updatePlayIcon(){ ppBtn.innerHTML=''; ppBtn.appendChild(icon(video.paused?ICONS.play:ICONS.pause)); }
      function showControls(){ controls.classList.add('visible'); media.classList.remove('hide-ui'); }
      function hideControls(){ controls.classList.remove('visible'); media.classList.add('hide-ui'); }
      function startPlaying(){
        media.classList.add('playing'); video.controls=false; video.muted=true;
        video.play().then(()=>{ updatePlayIcon(); showControls(); }).catch(()=>{});
      }

      // Hover-driven visibility in grid view
      let over=false, hideTimer=null;
      function inFS(){ return document.fullscreenElement===video || document.fullscreenElement===media; }

      const enter = ()=>{ over=true; showControls(); };
      const leave = ()=>{ over=false; if (!inFS()) hideControls(); };
      media.addEventListener('pointerenter', enter); media.addEventListener('pointerleave', leave);
      // Fallback for very old browsers:
      media.addEventListener('mouseenter', enter); media.addEventListener('mouseleave', leave); /* mouse vs pointer. :contentReference[oaicite:1]{index=1} */

      // Auto-hide in fullscreen after inactivity
      function fsBreathe(){ if (!inFS()) return; showControls(); clearTimeout(hideTimer);
        hideTimer=setTimeout(()=>{ if (inFS() && !over) hideControls(); }, 2000);
      }
      ['mousemove','pointermove','touchstart'].forEach(ev=>media.addEventListener(ev, fsBreathe, {passive:true}));
      document.addEventListener('fullscreenchange', ()=>{ /* Fullscreen API. */  /* :contentReference[oaicite:2]{index=2} */
        if (inFS()){ fsBreathe(); } else { clearTimeout(hideTimer); if (!over) hideControls(); }
      });

      // Controls
      playBtn.addEventListener('click', startPlaying);
      overlay.addEventListener('click', startPlaying);
      video.addEventListener('click', ()=>{ video.paused?video.play():video.pause(); });
      ppBtn.addEventListener('click', ()=>{ video.paused?video.play():video.pause(); });
      video.addEventListener('play', ()=>{ updatePlayIcon(); fsBreathe(); });
      video.addEventListener('pause', ()=>{ updatePlayIcon(); if (!inFS() && !over) hideControls(); });

      function fmt(t){ t=Math.max(0, t|0); const m=(t/60)|0, s=t%60; return `${m}:${s.toString().padStart(2,'0')}`; }
      function updateTime(){ const d=isFinite(video.duration)?video.duration:0; time.textContent=`${fmt(video.currentTime)} / ${fmt(d)}`;
        if (d>0 && !seek.dragging){ seek.max=d; seek.value=video.currentTime; } }
      video.addEventListener('timeupdate', updateTime);
      video.addEventListener('durationchange', updateTime);
      seek.addEventListener('input', ()=>{ seek.dragging=true; showControls(); });
      seek.addEventListener('change', ()=>{ video.currentTime=parseFloat(seek.value||'0'); seek.dragging=false; showControls(); });

      function toggleSound(){ video.muted=!video.muted; volBtn.innerHTML=''; volBtn.appendChild(icon(video.muted?ICONS.mute:ICONS.volume)); showControls(); }
      volBtn.addEventListener('click', toggleSound);

      function goFullscreen(){ const el=video; if (el.requestFullscreen) el.requestFullscreen(); else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen(); else if (el.msRequestFullscreen) el.msRequestFullscreen(); }
      fsBtn.addEventListener('click', goFullscreen);
      media.addEventListener('dblclick', goFullscreen);

      // Keyboard shortcuts
      card.addEventListener('keydown', (e)=>{ if (e.code==='Space'){ e.preventDefault(); video.paused?video.play():video.pause(); }
        if (e.key==='m'||e.key==='M'){ toggleSound(); } if (e.key==='f'||e.key==='F'){ goFullscreen(); } });

      // Pause when scrolled offscreen
      const io=new IntersectionObserver(es=>{ es.forEach(e=>{ if(!e.isIntersecting) video.pause(); }); }, {threshold:.1});
      io.observe(card);

      return card;
    }

    function init(){ const root=$("#gallery"); VIDEOS.forEach(v=>root.appendChild(renderCard(v))); }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
