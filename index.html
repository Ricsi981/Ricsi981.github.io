<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulation Gallery</title>
  <meta name="description" content="Looping video gallery of simulations" />
  <style>
    :root {
      --bg: #0b0d12;
      --card: #121622;
      --text: #e8eefc;
      --muted: #a9b3c7;
      --accent: #7aa2ff;
      --ring: rgba(122, 162, 255, 0.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 10% -10%, #172036 0, transparent 60%),
                  radial-gradient(900px 700px at 110% 10%, #13203b 0, transparent 60%),
                  var(--bg);
    }
    header {
      padding: 28px 18px 12px;
      text-align: center;
    }
    header h1 { margin: 0 0 6px; font-weight: 700; letter-spacing: 0.2px; }
    header p { margin: 0; color: var(--muted); }

    .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
    }

    .card {
      background: linear-gradient(to bottom right, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      border-radius: 16px;
      overflow: hidden;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:focus-within, .card:hover {
      transform: translateY(-2px);
      border-color: var(--ring);
      box-shadow: 0 18px 40px rgba(30, 60, 120, 0.3);
    }

    .media {
      position: relative;
      aspect-ratio: 16/9;
      background: #0a0f18;
      display: block;
      overflow: hidden;
    }
    .media img, .media video {
      width: 100%; height: 100%; object-fit: cover; display: block;
    }
    .media video { background: #000; }

    .overlay {
      position: absolute; inset: 0; display: grid; place-items: center;
      background: linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,.1));
      opacity: 1; transition: opacity .2s ease;
    }
    .media.playing .overlay { opacity: 0; pointer-events: none; }

    .playbtn {
      border: 0; background: rgba(10, 20, 40, 0.75);
      border-radius: 999px; padding: 14px 18px; display: inline-flex; gap: 10px; align-items: center;
      color: var(--text); font-weight: 600; cursor: pointer;
      box-shadow: 0 8px 30px rgba(0,0,0,0.35), inset 0 0 0 1px rgba(255,255,255,0.08);
      transition: transform .12s ease, background .2s ease;
      backdrop-filter: blur(6px);
    }
    .playbtn:hover { transform: translateY(-1px); background: rgba(20, 40, 80, 0.8); }
    .playbtn svg { width: 18px; height: 18px; }

    .tools {
      position: absolute; right: 8px; bottom: 8px; display: flex; gap: 6px; z-index: 2;
    }
    .iconbtn {
      border: 0; background: rgba(0,0,0,.55); color: var(--text); width: 36px; height: 36px; border-radius: 10px;
      display: grid; place-items: center; cursor: pointer; backdrop-filter: blur(4px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }
    .iconbtn:hover { background: rgba(0,0,0,.7); }
    .iconbtn svg { width: 18px; height: 18px; }

    /* --- Custom control bar (auto-hide) --- */
    .controls {
      position: absolute; left: 0; right: 0; bottom: 0; z-index: 5;
      display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 8px;
      padding: 8px 10px; border-top-left-radius: 12px; border-top-right-radius: 12px;
      background: linear-gradient(to top, rgba(0,0,0,0.65), rgba(0,0,0,0.25));
      backdrop-filter: blur(4px);
      opacity: 0; transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events: none; /* prevent blocking clicks when hidden */
    }
    .controls.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }

    .controls .btn { width: 36px; height: 36px; border-radius: 10px; border: 0; cursor: pointer; color: var(--text);
      background: rgba(0,0,0,.55); display: grid; place-items: center; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }
    .controls .btn:hover { background: rgba(0,0,0,.7); }
    .controls .btn svg { width: 18px; height: 18px; }

    .controls .time { font-size: 13px; color: #e8eefce6; min-width: 88px; text-align: right; }

    .controls .seek { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; border-radius: 999px; background: rgba(255,255,255,0.25); outline: none; }
    .controls .seek::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%; background: white; box-shadow: 0 0 0 2px rgba(0,0,0,.35); }
    .controls .seek::-moz-range-thumb { width: 14px; height: 14px; border-radius: 50%; background: white; border: 0; box-shadow: 0 0 0 2px rgba(0,0,0,.35); }

    /* Hide mouse cursor when UI is hidden */
    .media.hide-ui { cursor: none; }

    .meta { padding: 12px 14px 16px; }
    .title { margin: 0 0 6px; font-size: 16px; line-height: 1.25; }
    .desc { margin: 0; color: var(--muted); font-size: 14px; line-height: 1.45; }

    .sr-only { position: absolute; width: 1px; height: 1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

    footer { text-align:center; color: var(--muted); padding: 24px 0 44px; font-size: 13px; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <h1>Simulation Gallery</h1>
    <p>Click a thumbnail to start an <strong>infinite looping</strong> preview. Double‚Äëclick the video for fullscreen.</p>
  </header>

  <main class="container">
    <div id="gallery" class="grid" aria-live="polite"></div>
  </main>

  <footer>
    Made with ‚ù§ and HTML5 video. Add more items in <code>VIDEOS</code> in this file.
  </footer>

  <script>
    // üëâ Replace these with your real videos and posters
    const VIDEOS = [
      {
        title: "Alpha Amylase",
        mp4: "assets/videos/alpha_amylase_softShadows.mp4", // H.264 for Safari/iOS
        webm: "assets/videos/alpha_amylase_softShadows.webm", // VP9/AV1 for Chrome/Firefox (optional)
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "T = 298 K, pH 7.0, ionic strength 0.15 M; implicit solvent model.",
      },
                  {
        title: "Apoptosome",
        mp4: "assets/videos/apopt_3JBT-assembly1.mp4", // H.264 for Safari/iOS
        webm: "assets/videos/apopt_3JBT-assembly1.webm", // VP9/AV1 for Chrome/Firefox (optional)
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "T = 298 K, pH 7.0, ionic strength 0.15 M; implicit solvent model.",
      },
                  {
        title: "Ferritin",
        mp4: "assets/videos/ferritin.mp4", // H.264 for Safari/iOS
        webm: "assets/videos/ferritin.webm", // VP9/AV1 for Chrome/Firefox (optional)
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "T = 298 K, pH 7.0, ionic strength 0.15 M; implicit solvent model.",
      },
                              {
        title: "P53",
        mp4: "assets/videos/p53_1tup-assembly.mp4", // H.264 for Safari/iOS
        webm: "assets/videos/p53_1tup-assembly.webm", // VP9/AV1 for Chrome/Firefox (optional)
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "T = 298 K, pH 7.0, ionic strength 0.15 M; implicit solvent model.",
      },
                  {
        title: "SSB4",
        mp4: "assets/videos/fold_ecoli_ssb_4.mp4", // H.264 for Safari/iOS
        webm: "assets/videos/fold_ecoli_ssb_4.webm", // VP9/AV1 for Chrome/Firefox (optional)
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "T = 298 K, pH 7.0, ionic strength 0.15 M; implicit solvent model.",
      },
      {
        title: "LC8",
        mp4: "assets/videos/lc8.mp4",
        webm: "assets/videos/lc8.webm",
 // poster: (omitted) ‚Üí will auto-use first frame
        description: "CALVADOS CG, 1 ¬µs simulated, chain length 120 aa; boomerang loop clip.",
      }
    ];

    const $ = sel => document.querySelector(sel);

    function icon(pathD) {
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.setAttribute("aria-hidden", "true");
      const p = document.createElementNS(svg.namespaceURI, "path");
      p.setAttribute("d", pathD);
      p.setAttribute("fill", "currentColor");
      svg.appendChild(p);
      return svg;
    }

    const ICONS = {
      play: "M8 5v14l11-7z",
      pause: "M6 5h4v14H6zm8 0h4v14h-4z",
      volume: "M3 10v4h4l5 5V5L7 10H3zm13.54 2a4.5 4.5 0 0 0-2.04-3.77v7.54A4.5 4.5 0 0 0 16.54 12zm2.46 0a7 7 0 0 1-3.17 5.9l1.17 1.61A9 9 0 0 0 22 12a9 9 0 0 0-4.99-8.07l-1.17 1.61A7 7 0 0 1 19 12z",
      mute: "M16.5 12 21 16.5 19.5 18l-4.5-4.5L10 18l-3-3h-4v-6h4l3-3 5 4.5L19.5 6 21 7.5 16.5 12z",
      fullscreen: "M7 14H5v5h5v-2H7v-3zm12 5h-5v-2h3v-3h2v5zM7 5h3V3H5v5h2V5zm10 0v3h3v2h-5V3h2v2z",
    };

    // Auto-generate a poster image from the first frame if none is provided.
    // Works for same-origin videos (your GitHub Pages files are same-origin).
    function autoPoster(video) {
      if (video.dataset.posterReady) return;
      const capture = () => {
        const w = video.videoWidth || 1280;
        const h = video.videoHeight || Math.round(w * 9/16);
        if (!w || !h) return;
        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        const ctx = canvas.getContext('2d');
        try {
          ctx.drawImage(video, 0, 0, w, h);
          const dataURL = canvas.toDataURL('image/jpeg', 0.82);
          video.setAttribute('poster', dataURL);
          video.dataset.posterReady = '1';
        } catch (e) {
          // Likely CORS; on same-origin GitHub Pages assets this should not happen.
        }
      };

      const seekToStartAndCapture = () => {
        const onSeeked = () => {
          video.removeEventListener('seeked', onSeeked);
          capture();
        };
        video.addEventListener('seeked', onSeeked, { once: true });
        try { video.currentTime = 0; } catch { capture(); }
      };

      if (video.readyState >= 2) { // HAVE_CURRENT_DATA
        seekToStartAndCapture();
      } else {
        const onLoaded = () => {
          video.removeEventListener('loadeddata', onLoaded);
          seekToStartAndCapture();
        };
        video.addEventListener('loadeddata', onLoaded, { once: true });
      }
    }

    function renderCard(item, idx) {
      const card = document.createElement('article');
      card.className = 'card';
      card.tabIndex = 0; // focus ring

      const media = document.createElement('div');
      media.className = 'media';

      const video = document.createElement('video');
      video.setAttribute('playsinline', '');
      video.setAttribute('muted', ''); // required for autoplay policies
      video.setAttribute('loop', ''); // infinite loop
      video.setAttribute('preload', 'metadata');
      video.crossOrigin = 'anonymous'; // allow canvas capture for poster
      if (item.poster) video.setAttribute('poster', item.poster);
      video.setAttribute('aria-label', item.title);
      video.controls = false; // start without native controls

      // Sources for better browser support
      const srcMp4 = document.createElement('source');
      srcMp4.src = item.mp4; srcMp4.type = 'video/mp4';
      video.appendChild(srcMp4);
      if (item.webm) {
        const srcWebm = document.createElement('source');
        srcWebm.src = item.webm; srcWebm.type = 'video/webm';
        video.appendChild(srcWebm);
      }

      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      const playBtn = document.createElement('button');
      playBtn.className = 'playbtn';
      playBtn.appendChild(icon(ICONS.play));
      playBtn.appendChild(document.createTextNode(' Play'));
      playBtn.setAttribute('aria-label', `Play ${item.title}`);
      overlay.appendChild(playBtn);

      // Custom controls bar (auto-hide)
      const controls = document.createElement('div');
      controls.className = 'controls';

      const ppBtn = document.createElement('button');
      ppBtn.className = 'btn';
      ppBtn.title = 'Play/Pause';
      ppBtn.appendChild(icon(ICONS.play));

      const seek = document.createElement('input');
      seek.type = 'range'; seek.className = 'seek'; seek.min = 0; seek.step = 0.05; seek.value = 0;

      const time = document.createElement('div');
      time.className = 'time'; time.textContent = '0:00 / 0:00';

      const volBtn = document.createElement('button');
      volBtn.className = 'btn';
      volBtn.title = 'Toggle sound';
      volBtn.appendChild(icon(ICONS.mute));

      const fsBtn = document.createElement('button');
      fsBtn.className = 'btn';
      fsBtn.title = 'Fullscreen';
      fsBtn.appendChild(icon(ICONS.fullscreen));

      controls.appendChild(ppBtn);
      controls.appendChild(seek);
      controls.appendChild(time);
      controls.appendChild(volBtn);
      controls.appendChild(fsBtn);

      media.appendChild(video);
      media.appendChild(overlay);
      media.appendChild(controls);

      const meta = document.createElement('div');
      meta.className = 'meta';
      const h3 = document.createElement('h3'); h3.className = 'title'; h3.textContent = item.title;
      const p = document.createElement('p'); p.className = 'desc'; p.textContent = item.description || '';
      meta.appendChild(h3); meta.appendChild(p);

      card.appendChild(media);
      card.appendChild(meta);

      // Interactions
      function startPlaying() {
        media.classList.add('playing');
        video.controls = false; // use custom controls so we can auto-hide
        video.muted = true; // ensure muted at start for autoplay
        video.play().then(() => {
          updatePlayIcon();
          showControls();
        }).catch(() => {});
      });
      }
      function toggleSound() {
        video.muted = !video.muted;
        volBtn.innerHTML = '';
        volBtn.appendChild(icon(video.muted ? ICONS.mute : ICONS.volume));
        showControls();
      }
      function goFullscreen() {
        const el = video; // fullscreen the video element
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if (el.msRequestFullscreen) el.msRequestFullscreen();
      }

      playBtn.addEventListener('click', startPlaying);
      // Also click anywhere on media area to start
      overlay.addEventListener('click', startPlaying);

      // Toggle play/pause on single click
      video.addEventListener('click', () => { if (!video.paused) video.pause(); else video.play(); });

      // Controls: play/pause
      function updatePlayIcon(){
        ppBtn.innerHTML = '';
        ppBtn.appendChild(icon(video.paused ? ICONS.play : ICONS.pause));
      }
      ppBtn.addEventListener('click', () => { video.paused ? video.play() : video.pause(); });
      video.addEventListener('play', () => { updatePlayIcon(); showControls(); });
      video.addEventListener('pause', () => { updatePlayIcon(); showControls(false); });

      // Time + seek
      function fmt(t){ t=Math.max(0, t|0); const m=(t/60)|0, s=t%60; return `${m}:${s.toString().padStart(2,'0')}`; }
      function updateTime(){
        const d = isFinite(video.duration) ? video.duration : 0;
        time.textContent = `${fmt(video.currentTime)} / ${fmt(d)}`;
        if (d>0 && !seek.dragging) { seek.max = d; seek.value = video.currentTime; }
      }
      video.addEventListener('timeupdate', updateTime);
      video.addEventListener('durationchange', updateTime);
      seek.addEventListener('input', () => { seek.dragging = true; showControls(); });
      seek.addEventListener('change', () => { video.currentTime = parseFloat(seek.value||'0'); seek.dragging = false; showControls(); });

      // Volume
      function toggleSound() {
        video.muted = !video.muted;
        volBtn.innerHTML = '';
        volBtn.appendChild(icon(video.muted ? ICONS.mute : ICONS.volume));
        showControls();
      }
      volBtn.addEventListener('click', toggleSound);

      // Fullscreen
      function goFullscreen() {
        const el = video; // fullscreen the video element
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if (el.msRequestFullscreen) el.msRequestFullscreen();
      }
      fsBtn.addEventListener('click', goFullscreen);
      media.addEventListener('dblclick', goFullscreen);

      // Auto-hide controls after inactivity
      let hideTimer = null;
      function showControls(auto = true){
        controls.classList.add('visible');
        media.classList.remove('hide-ui');
        if (hideTimer) clearTimeout(hideTimer);
        if (auto && !video.paused) hideTimer = setTimeout(() => {
          controls.classList.remove('visible');
          media.classList.add('hide-ui');
        }, 2000);
      }
      function pointerShow(){ showControls(true); }
      ['mousemove','touchstart','pointermove'].forEach(ev => media.addEventListener(ev, pointerShow));

      document.addEventListener('fullscreenchange', () => {
        // When entering fullscreen, ensure controls appear briefly then auto-hide
        if (document.fullscreenElement === video || document.fullscreenElement === media) {
          showControls(true);
        } else {
          // Leaving fullscreen: keep controls visible
          controls.classList.add('visible');
          media.classList.remove('hide-ui');
        }
      });

      // Keyboard shortcuts when focused
      card.addEventListener('keydown', (e) => {
        if (e.code === 'Space') { e.preventDefault(); video.paused ? video.play() : video.pause(); }
        if (e.key === 'm' || e.key === 'M') { toggleSound(); }
        if (e.key === 'f' || e.key === 'F') { goFullscreen(); }
      });

      // Pause when scrolled offscreen (saves CPU)
      const io = new IntersectionObserver(entries => {
        entries.forEach(e => { if (!e.isIntersecting) video.pause(); });
      }, { threshold: 0.1 });
      io.observe(card);

      return card;
    }

    function init() {
      const root = document.getElementById('gallery');
      VIDEOS.forEach((v, i) => root.appendChild(renderCard(v, i)));
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
